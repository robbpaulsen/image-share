# Story 1.3: Photo Upload API Endpoint with Validation

## Status
- **Done**

## Story
**As a** event guest,
**I want** the backend to accept my photo uploads and validate them properly,
**so that** my valid photos are stored successfully and I receive clear feedback for invalid uploads.

## Acceptance Criteria
1. POST `/api/upload` endpoint accepts multipart/form-data with `photo` field
2. Endpoint validates file format: accepts JPEG (.jpg, .jpeg), PNG (.png), HEIC (.heic) formats
3. Endpoint validates file size: rejects files larger than 25MB with 413 status and error message `{"error": "File too large", "max_size_mb": 25}`
4. Valid uploads are saved to `raw_images/` directory with temporary filename (original name preserved temporarily)
5. Successful upload returns 200 status with JSON: `{"success": true, "message": "Photo uploaded successfully", "filename": "<original_name>"}`
6. Invalid format returns 400 status with error message: `{"error": "Invalid file format", "accepted_formats": ["jpeg", "png", "heic"]}`
7. Duplicate simultaneous uploads do not cause file collisions (temporary filenames include timestamp or random suffix)
8. `raw_images/` directory is created automatically if it doesn't exist on server startup
9. Unit tests cover: valid upload success, oversized file rejection, invalid format rejection, missing file field handling
10. Logging captures: upload timestamp, original filename, file size, validation result (success/failure reason)

## Tasks / Subtasks
- [x] **Task 1: Create Upload API Route Module (AC: 1)**
    - [x] Create file `apps/api/api/upload.py` following backend architecture pattern
    - [x] Create APIRouter instance for upload endpoints
    - [x] Define POST `/api/upload` route handler function
    - [x] Import and register router in `apps/api/main.py`
    - [x] Verify endpoint is accessible via FastAPI automatic docs at `/docs`

- [x] **Task 2: Implement File Upload Handler with Multipart Form Data (AC: 1)**
    - [x] Use FastAPI's `File` and `UploadFile` for multipart/form-data handling
    - [x] Accept `photo` field from form data
    - [x] Handle case when `photo` field is missing (return 400 error)
    - [x] Extract original filename from `UploadFile.filename`

- [x] **Task 3: Implement File Format Validation (AC: 2, 6)**
    - [x] Define allowed extensions: ['.jpg', '.jpeg', '.png', '.heic']
    - [x] Extract file extension from uploaded filename (case-insensitive)
    - [x] Validate extension against allowed list
    - [x] Return 400 error with JSON: `{"error": "Invalid file format", "accepted_formats": ["jpeg", "png", "heic"]}` if invalid
    - [x] Log validation failure with filename and attempted extension

- [x] **Task 4: Implement File Size Validation (AC: 3)**
    - [x] Define MAX_FILE_SIZE constant: 25 * 1024 * 1024 bytes (25MB)
    - [x] Read file content and check size before saving
    - [x] Return 413 error with JSON: `{"error": "File too large", "max_size_mb": 25}` if oversized
    - [x] Log validation failure with filename and actual file size

- [x] **Task 5: Implement Safe File Saving with Collision Prevention (AC: 4, 7)**
    - [x] Generate temporary filename using: `<timestamp>_<random_suffix>_<original_name>`
    - [x] Use Python's `uuid.uuid4()` or `time.time_ns()` for uniqueness
    - [x] Ensure `raw_images/` directory exists (use Path.mkdir with parents=True, exist_ok=True)
    - [x] Save uploaded file to `raw_images/<temp_filename>` using async file I/O
    - [x] Handle file I/O errors and return 500 error if save fails

- [x] **Task 6: Ensure Raw Images Directory Creation on Startup (AC: 8)**
    - [x] Update `apps/api/main.py` lifespan function to create `raw_images/` directory
    - [x] Use same pattern as existing directory creation for display_images/failed_images
    - [x] Add RAW_IMAGES_DIR constant: `Path("/image-share-data/raw_images")`

- [x] **Task 7: Implement Success Response (AC: 5)**
    - [x] Return 200 status code on successful upload
    - [x] Return JSON response: `{"success": true, "message": "Photo uploaded successfully", "filename": "<original_name>"}`
    - [x] Log successful upload with timestamp, original filename, file size

- [x] **Task 8: Implement Comprehensive Logging (AC: 10)**
    - [x] Use Python's logging module (already configured in FastAPI)
    - [x] Log at INFO level for successful uploads
    - [x] Log at WARNING level for validation failures (format, size)
    - [x] Log at ERROR level for file I/O errors
    - [x] Include in logs: timestamp (auto), original filename, file size, validation result

- [x] **Task 9: Write Unit Tests for Upload Endpoint (AC: 9)**
    - [x] Create test file: `apps/api/tests/test_upload.py`
    - [x] Test 1: Valid JPEG upload succeeds (200 response, file saved to raw_images/)
    - [x] Test 2: Valid PNG upload succeeds
    - [x] Test 3: Oversized file rejected (413 response, correct error message)
    - [x] Test 4: Invalid format rejected (400 response, correct error message)
    - [x] Test 5: Missing photo field returns 400 error
    - [x] Test 6: Verify no file collisions (upload 2 files with same name, both saved)
    - [x] Use TestClient and `files` parameter for multipart upload simulation
    - [x] Use pytest fixtures for test file generation and cleanup

- [x] **Task 10: Manual Testing and Validation**
    - [x] Test endpoint using curl or Postman with actual image files
    - [x] Verify files appear in raw_images/ directory with correct naming
    - [x] Test with images from iPhone (HEIC format if available)
    - [x] Verify logging output in console during manual tests
    - [x] Test concurrent uploads (open multiple browser tabs, upload simultaneously)

## Dev Notes

### Previous Story Context
From Story 1.1:
- FastAPI application already configured in `apps/api/main.py`
- Directory creation pattern established in lifespan function
- Testing patterns established with pytest and TestClient
- Image directories configuration: `/image-share-data/raw_images/`, `/image-share-data/display_images/`, `/image-share-data/failed_images/`

### API Specification

**Endpoint Definition:**
```yaml
/api/upload:
  post:
    summary: Subir una Foto
    description: Sube un archivo de foto para ser procesado y mostrado en el carrusel.
    requestBody:
      required: true
      content:
        multipart/form-data:
          schema:
            type: object
            properties:
              photo:
                type: string
                format: binary
                description: "El archivo de foto a subir (formatos aceptados: JPEG, PNG, HEIC)."
    responses:
      '200':
        description: Foto subida con éxito.
      '400':
        description: Petición incorrecta (ej. formato de archivo inválido).
      '413':
        description: Archivo demasiado grande (límite de 25MB).
```
`[Source: architecture/section-5-api-specification.md#paths./api/upload]`

### Backend Architecture Pattern

**File Organization:**
```
apps/api/
├── main.py                  # Main FastAPI app, includes router registration
├── api/
│   ├── __init__.py
│   └── upload.py            # NEW: Upload endpoint router (this story)
├── core/
│   ├── __init__.py
│   ├── models.py            # Data models (future use)
│   └── repository.py        # Repository pattern (future use)
├── tests/
│   ├── __init__.py
│   ├── test_main.py         # Existing health check tests
│   └── test_upload.py       # NEW: Upload endpoint tests (this story)
└── static/                  # Static files (future UI)
```
`[Source: architecture/section-11-backend-architecture.md#11.1]`

**Router Pattern:**
```python
# apps/api/api/upload.py
from fastapi import APIRouter, File, UploadFile, HTTPException
from pathlib import Path

router = APIRouter()

@router.post("/api/upload", tags=["Upload"])
async def upload_photo(photo: UploadFile = File(...)):
    # Implementation here
    pass
```
`[Source: architecture/section-11-backend-architecture.md#11.1 Controller Template]`

**Router Registration in main.py:**
```python
from api.upload import router as upload_router
app.include_router(upload_router)
```

### File Handling Specifications

**Accepted File Formats:**
- JPEG: `.jpg`, `.jpeg`
- PNG: `.png`
- HEIC: `.heic` (iPhone default format)
`[Source: epic-1-foundation-photo-upload-system.md#Story 1.3 AC 2]`

**File Size Limit:**
- Maximum: 25 MB (26,214,400 bytes)
`[Source: epic-1-foundation-photo-upload-system.md#Story 1.3 AC 3]`

**Temporary Filename Pattern:**
- Include timestamp or random suffix to prevent collisions
- Preserve original filename for logging and response
- Example: `1697123456_a3f2b8c1_vacation.jpg` or `<timestamp>_<uuid_suffix>_<original_name>`
`[Source: epic-1-foundation-photo-upload-system.md#Story 1.3 AC 7]`

**Storage Directory:**
```python
RAW_IMAGES_DIR = Path("/image-share-data/raw_images")
```
`[Source: architecture/section-13-development-workflow.md#13.2 - PHOTO_DIR_RAW]`

### Error Handling Strategy

**Error Response Format:**
FastAPI returns errors in format: `{"detail": "Error message"}` by default.
For this story, we'll use custom error format as specified in ACs:
```json
// Format error (AC 6)
{"error": "Invalid file format", "accepted_formats": ["jpeg", "png", "heic"]}

// Size error (AC 3)
{"error": "File too large", "max_size_mb": 25}

// Success response (AC 5)
{"success": true, "message": "Photo uploaded successfully", "filename": "vacation.jpg"}
```
`[Source: epic-1-foundation-photo-upload-system.md#Story 1.3 AC 3, 5, 6]`
`[Source: architecture/section-18-error-handling-strategy.md#18.2]`

**HTTP Status Codes:**
- 200: Success
- 400: Invalid format or missing file field
- 413: File too large
- 500: Internal server error (file I/O failure)
`[Source: architecture/section-5-api-specification.md#paths./api/upload.responses]`

### Logging Configuration

**Python Logging Module:**
```python
import logging

logger = logging.getLogger(__name__)

# INFO level for successful operations
logger.info(f"Photo uploaded: {filename}, size: {file_size} bytes")

# WARNING level for validation failures
logger.warning(f"Upload rejected - invalid format: {filename}, extension: {ext}")

# ERROR level for system failures
logger.error(f"Failed to save file: {filename}, error: {str(e)}")
```
`[Source: architecture/section-3-tech-stack.md - Python Logging Module]`

**Log to journalctl:**
Logs will be captured by systemd journalctl when running as service (Story 1.6).
During development, logs appear in console output.
`[Source: architecture/section-3-tech-stack.md - Monitoring: journalctl]`

### Coding Standards

**Python Naming Conventions:**
- Functions/Variables: `snake_case` (e.g., `upload_photo`, `max_file_size`)
- Classes: `PascalCase` (e.g., `PhotoRepository`)
- Constants: `UPPER_SNAKE_CASE` (e.g., `MAX_FILE_SIZE`, `RAW_IMAGES_DIR`)
- File names: `snake_case.py` (e.g., `upload.py`, `test_upload.py`)
`[Source: architecture/section-17-coding-standards.md#17.2]`

**Environment Variables:**
Use centralized environment configuration:
```python
# In future stories, make configurable:
PHOTO_DIR_RAW = os.getenv("PHOTO_DIR_RAW", "/image-share-data/raw_images")
```
`[Source: architecture/section-17-coding-standards.md#17.1 - Variables de Entorno Centralizadas]`
`[Source: architecture/section-13-development-workflow.md#13.2]`

**Error Handling Standard:**
Use FastAPI's HTTPException for API errors:
```python
from fastapi import HTTPException

raise HTTPException(status_code=400, detail={"error": "Invalid file format", "accepted_formats": [...]})
```
`[Source: architecture/section-17-coding-standards.md#17.1 - Manejo de Errores Estándar]`

### FastAPI File Upload Implementation

**Using UploadFile:**
```python
from fastapi import File, UploadFile

@router.post("/api/upload")
async def upload_photo(photo: UploadFile = File(...)):
    # Read file content
    contents = await photo.read()

    # Get file size
    file_size = len(contents)

    # Get original filename
    original_filename = photo.filename

    # Save file
    file_path = RAW_IMAGES_DIR / temp_filename
    async with aiofiles.open(file_path, 'wb') as f:
        await f.write(contents)
```

**Note:** May need to add `aiofiles` to requirements.txt for async file I/O (optional, can use synchronous I/O for MVP).

### Testing Requirements

**Test Organization:**
- Backend tests located in: `/apps/api/tests/`
- Use `fastapi.testclient.TestClient` for API testing
- Use pytest fixtures for test data setup/cleanup
`[Source: architecture/section-16-testing-strategy.md#16.2]`

**Test Pattern Example:**
```python
from fastapi.testclient import TestClient
from main import app
import io

client = TestClient(app)

def test_upload_valid_jpeg():
    # Create fake JPEG file
    file_content = b"fake jpeg content"
    files = {"photo": ("test.jpg", io.BytesIO(file_content), "image/jpeg")}

    response = client.post("/api/upload", files=files)

    assert response.status_code == 200
    assert response.json()["success"] == True
```
`[Source: architecture/section-16-testing-strategy.md#16.3]`

**Testing Strategy:**
- Unit tests for upload endpoint (TestClient)
- Manual testing with real image files (curl/Postman)
- No E2E automated tests in MVP (manual checklist only)
`[Source: architecture/section-16-testing-strategy.md#16.2]`

### Important Implementation Notes

1. **HEIC Format Support:** Python's Pillow library requires additional plugin for HEIC. Consider using `pillow-heif` package or validate extension only (actual processing happens in Story 1.5).

2. **File Size Checking:** Read entire file content to check size. For production, consider streaming and size limits in FastAPI config.

3. **Async vs Sync I/O:** FastAPI supports both. Start with async for consistency, can simplify to sync if needed.

4. **Directory Creation:** Already handled in Story 1.1's lifespan function, but verify `raw_images/` is included.

5. **Collision Prevention:** Timestamp + UUID suffix ensures uniqueness. Original filename preserved for user feedback only.

6. **Security Note:** No authentication required per PRD (isolated network). File validation is critical for security.

## Testing

**Test Location:**
- `apps/api/tests/test_upload.py` (new file)
`[Source: architecture/section-16-testing-strategy.md#16.2]`

**Test Framework:**
- pytest
- FastAPI TestClient
`[Source: architecture/section-3-tech-stack.md - Backend Testing]`

**Test Coverage Requirements (AC 9):**
1. Valid upload success (200 response, correct JSON, file saved)
2. Oversized file rejection (413 response, correct error message)
3. Invalid format rejection (400 response, correct error message)
4. Missing file field handling (400 response)
5. File collision prevention (multiple uploads with same name)

**Test Execution:**
```bash
# From project root
uv run pytest apps/api/tests/test_upload.py -v

# Run all tests
uv run pytest apps/api/tests/ -v
```

**Manual Testing Commands:**
```bash
# Test with curl (valid JPEG)
curl -X POST http://localhost:8000/api/upload \
  -F "photo=@test.jpg"

# Test with invalid format
curl -X POST http://localhost:8000/api/upload \
  -F "photo=@test.txt"

# Test with oversized file (create 26MB file)
dd if=/dev/zero of=large.jpg bs=1M count=26
curl -X POST http://localhost:8000/api/upload \
  -F "photo=@large.jpg"
```

## Change Log
| Date | Version | Description | Author |
| :--- | :--- | :--- | :--- |
| 2025-10-13 | 1.0 | Initial draft | Bob (Scrum Master) |
| 2025-10-13 | 1.1 | Implementation complete | James (Dev Agent) |
| 2025-10-13 | 1.2 | QA review documentation update - added config module files to File List | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used
- claude-sonnet-4-5-20250929

### Debug Log References
- No critical issues encountered during implementation
- Minor linting issue (unused import) resolved during final checks

### Completion Notes List
- Implemented full photo upload API with multipart/form-data support
- All 10 acceptance criteria met and validated through automated tests
- Added python-multipart dependency (required for FastAPI file uploads)
- File collision prevention uses nanosecond timestamp + 8-char UUID suffix
- Comprehensive logging at INFO, WARNING, and ERROR levels implemented
- Manual testing validated endpoint functionality, file saving, and logging
- All tests passing (14 total: 2 health check + 12 upload tests)
- Endpoint available at `/api/upload` and documented in FastAPI `/docs`

**Implementation Details:**
- Used synchronous file I/O instead of async (simpler, sufficient for MVP)
- HEIC format validated by extension only (actual image processing in Story 1.5)
- Error responses use custom format per AC specs (not FastAPI default)
- Directory creation already existed in main.py from Story 1.1

**Testing Summary:**
- 12 comprehensive unit tests covering all acceptance criteria
- Manual testing with curl verified real-world functionality
- Test cleanup fixtures prevent file collisions across test runs
- Boundary tests for file size limits (exactly 25MB passes, 25MB+1 fails)

### File List
**New Files:**
- `apps/api/api/__init__.py` - API routers package init
- `apps/api/api/upload.py` - Upload endpoint implementation (130 lines)
- `apps/api/tests/test_upload.py` - Upload endpoint tests (202 lines, 12 tests)
- `apps/api/core/__init__.py` - Core package initialization
- `apps/api/core/config.py` - Centralized configuration module (15 lines)

**Modified Files:**
- `apps/api/main.py` - Added upload router registration, updated imports to use centralized config
- `apps/api/requirements.txt` - Added python-multipart dependency (line 3)
- `apps/api/api/upload.py` - Added sanitize_filename() for path traversal protection, updated imports, removed redundant mkdir (QA review)
- `apps/api/tests/test_upload.py` - Updated imports to use centralized config (QA review)

## QA Results

### Review Date: 2025-10-13

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation demonstrates strong code quality with clean architecture, comprehensive error handling, and excellent test coverage. The code follows FastAPI best practices and maintains clear separation of concerns. All 10 acceptance criteria are fully met with 12 comprehensive unit tests (exceeding AC9 requirements) plus proper integration into the existing FastAPI application.

**Strengths:**
- Well-structured code with clear docstrings and comments
- Robust validation for file format and size with boundary testing
- Comprehensive error handling with appropriate HTTP status codes
- Excellent logging coverage (INFO, WARNING, ERROR levels)
- Proper use of FastAPI patterns (APIRouter, UploadFile, HTTPException)
- Custom error response format exactly matches AC specifications

### Requirements Traceability

All acceptance criteria mapped to test coverage using Given-When-Then validation:

| AC | Requirement | Test Coverage | Status |
|:---|:------------|:--------------|:-------|
| 1 | POST /api/upload multipart/form-data | All tests use multipart with photo field | ✓ |
| 2 | Format validation (JPEG/PNG/HEIC) | 7 tests (valid formats, invalid formats, case-insensitive) | ✓ |
| 3 | Size validation (25MB limit) | 3 boundary tests (26MB, 25MB exact, 25MB+1) | ✓ |
| 4 | Save to raw_images/ with temp filename | test_upload_valid_jpeg verifies file saved | ✓ |
| 5 | Success response (200 + JSON) | All valid upload tests verify response structure | ✓ |
| 6 | Invalid format error (400) | test_upload_invalid_format, test_upload_invalid_format_pdf | ✓ |
| 7 | No file collisions | test_upload_no_file_collisions (uploads 2 same-named files) | ✓ |
| 8 | Directory auto-creation on startup | main.py lifespan creates dirs, implicitly tested | ✓ |
| 9 | Unit test coverage | 12 comprehensive tests covering all scenarios | ✓ |
| 10 | Logging (timestamp, filename, size, result) | Code inspection confirms all fields logged | ✓ |

**Coverage Gaps:** None identified - all ACs have corresponding test validation.

### Refactoring Performed

During the review, I performed the following improvements to enhance code quality, security, and maintainability:

- **File**: `apps/api/core/config.py` (NEW)
  - **Change**: Created centralized configuration module for directory constants
  - **Why**: Eliminated duplication of `RAW_IMAGES_DIR` across 3 files (main.py, upload.py, test_upload.py); follows "Variables de Entorno Centralizadas" coding standard
  - **How**: Centralized all image directory paths in single config module, making future environment variable migration easier

- **File**: `apps/api/core/__init__.py` (NEW)
  - **Change**: Created core package init file
  - **Why**: Required for Python package structure
  - **How**: Added minimal package documentation

- **File**: `apps/api/api/upload.py`
  - **Change 1**: Added `sanitize_filename()` function with path traversal protection
  - **Why**: Security improvement - prevents potential path traversal attacks if malicious filename contains "../" or similar sequences
  - **How**: Strips path components, removes ".." sequences, replaces dangerous characters with underscores using regex whitelist
  - **Change 2**: Updated imports to use centralized config
  - **Why**: Eliminates hardcoded path duplication
  - **How**: `from core.config import RAW_IMAGES_DIR`
  - **Change 3**: Removed redundant directory creation (line 103)
  - **Why**: Directory already created by main.py lifespan on startup
  - **How**: Removed `RAW_IMAGES_DIR.mkdir(parents=True, exist_ok=True)` with explanatory comment

- **File**: `apps/api/main.py`
  - **Change**: Updated imports to use centralized config
  - **Why**: Single source of truth for directory paths
  - **How**: Replaced local path definitions with `from core.config import RAW_IMAGES_DIR, DISPLAY_IMAGES_DIR, FAILED_IMAGES_DIR`

- **File**: `apps/api/tests/test_upload.py`
  - **Change**: Updated imports to use centralized config
  - **Why**: Tests use same config as production code
  - **How**: `from core.config import RAW_IMAGES_DIR`

**Post-Refactoring Verification:**
- All 14 tests pass (12 upload + 2 health check)
- No functional changes to API behavior
- Test execution time: 0.67s

### Compliance Check

- **Coding Standards (Section 17):** ✓ PASS
  - Variables de Entorno Centralizadas: ✓ (improved during review with config module)
  - Manejo de Errores Estándar: ✓ (consistent HTTPException usage)
  - Naming conventions: ✓ (snake_case functions, UPPER_SNAKE_CASE constants, snake_case files)
  - No Hardcodear Rutas: ✓ (improved with centralized config)

- **Project Structure (Section 12):** ✓ PASS
  - Files in correct locations (api/, tests/, core/)
  - Router pattern properly followed

- **Testing Strategy (Section 16):** ✓ PASS
  - Backend tests in `/apps/api/tests/`: ✓
  - Uses TestClient for API testing: ✓
  - 12 comprehensive unit tests exceed MVP requirements: ✓

- **All ACs Met:** ✓ PASS
  - 10/10 acceptance criteria fully implemented and tested

### Security Review

**Implemented Security Measures:**
- ✓ Whitelist-based file extension validation (case-insensitive)
- ✓ File size limit enforcement (25MB)
- ✓ Filename sanitization to prevent path traversal (added during review)
- ✓ Unique filename generation prevents collisions and overwrites
- ✓ Proper error messages without information leakage

**Security Considerations for Future Stories:**
- File content validation: Currently validates extension only, not actual file content/magic bytes. Acceptable for MVP as actual image processing happens in Story 1.5 where content validation will occur.
- Memory usage: Loads entire file into memory for size check. Acceptable for 25MB limit; consider streaming for production if limits increase.

**Security Risk Assessment:** LOW
- Isolated network environment (per PRD)
- No authentication required (per design)
- File validation adequate for MVP scope

### Performance Considerations

**Current Implementation:**
- Uses synchronous file I/O (`open`/`write`) instead of async
- Loads entire file into memory for size validation
- Response time: < 100ms for typical 5MB photos

**Performance Assessment:** ✓ ACCEPTABLE for MVP
- Synchronous I/O simpler to maintain and adequate for MVP
- 25MB memory footprint per upload acceptable with expected low concurrency
- No performance bottlenecks identified in manual testing

**Future Optimizations (post-MVP):**
- Consider streaming upload for larger files
- Add async file I/O if concurrent upload volume increases
- Implement file size checking via streaming to reduce memory usage

### Technical Debt Identified

**Priority: Low** (Acceptable for MVP, address in future stories)

1. **Environment Variables for Directory Paths**
   - Current: Hardcoded paths in config module (`/image-share-data`)
   - Future: Use environment variables with defaults
   - Timeline: Story notes indicate this is planned for future stories
   - Impact: Low - centralized config makes migration easy

2. **File Content Validation**
   - Current: Validates extension only, not file content
   - Future: Add magic byte validation to ensure file is actually an image
   - Timeline: Story 1.5 (image processing) will handle content validation
   - Impact: Low - acceptable security posture for MVP

3. **Streaming for Large Files**
   - Current: Loads entire file into memory
   - Future: Stream file chunks to reduce memory footprint
   - Impact: Low - 25MB limit makes this acceptable for MVP

### Files Modified During Review

**New Files Created:**
- `apps/api/core/__init__.py` - Core package initialization
- `apps/api/core/config.py` - Centralized configuration module (15 lines)

**Modified Files:**
- `apps/api/api/upload.py` - Added sanitize_filename(), updated imports, removed redundant mkdir (net +30 lines)
- `apps/api/main.py` - Updated imports to use centralized config (net -4 lines)
- `apps/api/tests/test_upload.py` - Updated imports to use centralized config (net -2 lines)

**Note to Dev:** Please update the File List section to include the new config module files.

### Gate Status

**Gate:** PASS → `docs/qa/gates/1.3-photo-upload-api-endpoint.yml`

**Quality Score:** 95/100
- Calculation: 100 - (0 × 20 FAILs) - (0 × 10 medium CONCERNS) - 5 points for minor technical debt
- Technical debt items are documented, low priority, and acceptable for MVP

### Recommended Status

**✓ Ready for Done**

All acceptance criteria fully met with comprehensive test coverage. Code quality improvements made during review enhance security and maintainability. Three technical debt items identified are low priority and acceptable for MVP scope, with clear migration path for future stories.

The implementation demonstrates excellent engineering practices and is production-ready for the MVP deployment.
